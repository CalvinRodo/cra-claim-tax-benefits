extends ../base
include ../_includes/yesNoRadios

block variables
  -var title = __('Check Your Answers Before Filing Your Return')
  -var benefits = hasData(data, 'benefits') ? data.benefits : {}
  -var totalBenefits = hasData(data, 'benefits.totalBenefits.amount') ? data.benefits.totalBenefits.amount : 0
  -var incomes = hasData(data, 'financial.incomes') ? data.financial.incomes : {}
  -var taxes = hasData(data, 'financial.taxes') ? data.financial.taxes : {}
  -var refund = hasData(data, 'refund') ? data.refund : {}
  -var totalRefund = hasData(data, 'refund.totalRefund') ? data.refund.totalRefund : 0
  -var refundLines = sortByLineNumber(data.deductions, taxes, incomes, refund)
  -var count = 1;


block content

  h1 #{title}

  include ../_includes/backButton

  div
    p #{__('This is an overview of your projected tax return, and all the benefits you will receive when you file for the current tax year.')}
    p #{__('Take one final look before continuing. If something looks incorrect, please')} #[a(href="https://www.canada.ca/en/revenue-agency/corporate/contact-information/telephone-numbers.html") #{__('contact CRA')}] #{__('before filing.')}

  each section, index in answerInfo
    div
      .breakdown-table.breakdown-table--summary
        h2.breakdown-table__heading #{index}
        dl.breakdown-table-data
          each row in section
            .breakdown-table__row
              dt.breakdown-table__row-key #{row.text}
              dd.breakdown-table__row-value
                if row.infoPath.length > 1
                  - var totalVal = 0
                  //- are we adding strings?
                  if (typeof hasData(data,row.infoPath[0],true) === 'string') 
                    each val in row.infoPath
                      span=`${hasData(data, val, true)} `
                  //- or numbers?
                  else
                    each val in row.infoPath
                      - totalVal += parseInt(hasData(data, val, true))
                    span=totalVal
                else if row.infoPath.length <= 1
                  each val in row.infoPath
                    span #{hasData(data, val, true)}
              if row.urlPath !== ""
                dd.breakdown-table__row-link 
                  a(href=row.urlPath)
                    <span>Review<span class="visually-hidden"> #{row.text}</span>

  form.cra-form(method='post')
    div(class={['has-error']: errors && errors.review})
      .multiple-choice.multiple-choice--checkboxes
        if errors
          +validationMessage(errors.review.msg, key)
        .multiple-choice__item
          input(id='review' name='review' type="checkbox" value="review" checked=(value =='review') aria-describedby=(errors ? `review-error` : false))
          label(for='review') #{__('I confirm that, as far as I know, all the information in this tax return is accurate')}

    input#redirect(name='redirect', type='hidden', value='/confirmation')

    +formButtons('Submit my return')
